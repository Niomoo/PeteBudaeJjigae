<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <title>抓景點</title>
</head>

<body>
    <div class="navbar">
        <div>
            <span>景點條件輸入</span>
        </div>
        <div>
            <span class="navbardiv">距離</span>
            <select name="radius" id="radius">
                <option value=580>580</option>
                <option value=1000>1000</option>
                <option value=1500>1500</option>
                <option value=2000>2000</option>
                <option value=2500>2500</option>
                <option value=3000>3000</option>
                <option value=100000>100000</option>
            </select>
        </div>
        <div>
            <span class="navbardiv">分類</span>
            <select name="type" id="type">
                <option value="point_of_interest">有趣的點</option>
                <option value="tourist_attraction">景點</option>
                <option value="subway_station">捷運</option>
                <option value="bar">酒吧</option>
                <option value="restaurant">餐廳</option>
                <option value="liquor_store">酒類</option>
                <option value="subway_station">捷運</option>
                <option value="lodging">住宿</option>
                <!-- subway_station -->
            </select>
        </div>
        <div>
            <span class="navbardiv">輸入地點</span>
            <input type="text" name="place" id="place">
        </div>
        <div>
            <button type="button" name="button" id="name_btn">搜尋</button>
        </div>
        <div>
            <span class="navbardiv">緯度</span>
            <input type="text" name="lat" id="lat">
            <span class="navbardiv">經度</span>
            <input type="text" name="long" id="long">
        </div>
        <div>
            <button type="button" name="button" id="btn2">搜尋</button>
        </div>
    </div>
    <div class="index" id="placeList"></div>


</body>
<style>
    .navbar {
        /* position: fixed; */
        padding: 10px 15px;
        background-color: rgb(172, 100, 255);
        color: rgb(248, 248, 248);
        z-index: 3;
        width: 100%;
    }

    .navbardiv {
        margin-right: 25px;
    }

    .index {
        position: relative;
    }

    /* #placeList {
        top: 5vh;
    } */

    .rate {
        font-size: 14px;
    }

    .name {
        font-size: 20px;
    }
</style>
<script>
    //記得裝chrome的cors套件
    $(document).ready(function () {
        var lat;
        var lng;
        $("#name_btn").on("click", function () {
            // 半徑搜尋一次
            const nameElement = document.getElementById("radius");
            const radius = nameElement.value;
            const typeElement = document.getElementById("type");
            const type = typeElement.value;
            const placeElement = document.getElementById("place");
            const place = placeElement.value;
            var urlplace = "https://maps.googleapis.com/maps/api/geocode/json?address=" + place +"捷運站"+ "&key=AIzaSyDs1gM-sDYY2aJmnEDVJ2IjxIxsvS-So_w"
            $.ajax({
                type: "GET",
                url: urlplace,
                async: false,
                success: function (data) {
                    var place = data['results'];
                    lat = place[0].geometry.location.lat;
                    lng = place[0].geometry.location.lng;
                    // $("#placeList").append("<li class='list-group-item name'>" + place[0].geometry.location.lat + "</li>");
                }
            });
            var ur = "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=" + lat + "," + lng + "&radius=" + radius + "&type=" + type + "&key=AIzaSyDs1gM-sDYY2aJmnEDVJ2IjxIxsvS-So_w"
            $.ajax({
                type: "GET",
                url: ur,
                success: function (data) {
                    console.log(data);
                    var name = data['results'];
                    console.log(name);
                    for (i = 0; i < 100000; i++) {
                        $("#placeList").append("<li class='list-group-item name'>" + name[i].name + ":" + name[i].rating + ":" + name[i].types + "</li>");
                    }
                },
                error: function () {
                    console.log("error");
                }
            });
        });
        $("#btn2").on("click", function () {
            // 半徑搜尋多次
            var nameElement = document.getElementById("radius");
            var radius = nameElement.value;
            var typeElement = document.getElementById("type");
            var type = typeElement.value;
            // var lat1 = 23.001717;
            // var long1 = 120.185816;

            // console.log(lat1);
            // console.log(long1);
            for (a = 0; a < 62; a++) {
                for (b = 0; b < 54; b++) {
                    var lat1 = 23.001717 - 0.016 * a;
                    lat1 = lat1.toFixed(6);
                    var long1 = 120.185816 + 0.016 * b;
                    long1 = long1.toFixed(6);
                    var ur1 = "https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=" + lat1 + "," + long1 + "&radius=" + radius + "&type=" + type + "&key=AIzaSyDs1gM-sDYY2aJmnEDVJ2IjxIxsvS-So_w"
                    $.ajax({
                        type: "GET",
                        url: ur1,
                        success: function (data) {
                            console.log(data);
                            console.log(typeof (data));
                            var name = data['results'];
                            console.log(name);
                            for (i = 0; i < 100000; i++) {
                                $("#placeList").append("<li class='list-group-item name'>" + name[i].name + ":" + name[i].rating + ":" + name[i].user_ratings_total + ":" + name[i].vicinity + ":" + name[i].plus_code.compound_code + ":" + name[i].types + "</li>");
                            }
                        },
                        error: function () {
                            console.log("error");
                        }
                    });
                }
            }

        })
    });

</script>

</html>